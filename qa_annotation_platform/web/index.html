<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA Annotation Platform - OxyGent</title>
    <link rel="shortcut icon" href="./image/group-favicon.png?v=1" type="image/x-icon">
    <link rel="stylesheet" href="./css/style.css?v=7">
    <link rel="stylesheet" href="./css/annotation.css?v=5">
</head>
<body>
    <div class="annotation-wrapper">
        <!-- Header Navigation -->
        <header class="annotation-header">
            <div class="logo">
                <h1>QA Annotation Platform</h1>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary btn-small" onclick="applyFilters()">
                    Search
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="annotation-body">
            <!-- Left Sidebar -->
            <aside class="annotation-sidebar" id="annotationSidebar">
                <!-- Drag to resize -->
                <div class="sidebar-resize-handle" id="sidebarResizeHandle"></div>

                <!-- Global Filter Conditions -->
                <div class="sidebar-section global-filter-section">
                    <div class="sidebar-section-header" onclick="toggleSection('globalFilter')">
                        <span>üîç Filter Conditions</span>
                        <span class="toggle-icon" id="globalFilterToggleIcon">‚ñº</span>
                    </div>
                    <div class="section-content" id="globalFilterContent">
                        <!-- Time Range -->
                        <div class="filter-group">
                            <div class="filter-group-title">Time Range</div>
                            <input type="datetime-local" id="filterStartTime" class="filter-input-full">
                            <input type="datetime-local" id="filterEndTime" class="filter-input-full" style="margin-top: 8px;">
                        </div>

                        <!-- Data Type + Quick Filter -->
                        <div class="filter-group" style="margin-top: 8px;">
                            <div class="filter-group-title">Type & Status</div>
                            <select class="filter-select-full" id="filterDataType" onchange="applyFilters()">
                                <option value="">All Types</option>
                                <option value="e2e">End-to-End</option>
                                <option value="agent">Agent</option>
                                <option value="llm">LLM</option>
                                <option value="tool">Tool</option>
                                <option value="custom">Custom</option>
                            </select>
                            <select class="filter-select-full" id="filterStatus" onchange="applyFilters()" style="margin-top: 8px;">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="annotated">Annotated</option>
                                <option value="approved">Approved</option>
                                <option value="rejected">Rejected</option>
                            </select>
                            <select class="filter-select-full" id="filterPriority" onchange="applyFilters()" style="margin-top: 8px;">
                                <option value="">All Priorities</option>
                                <option value="0">P0-End-to-End</option>
                                <option value="1">P1-Agent</option>
                                <option value="2">P2-LLM</option>
                                <option value="3">P3-Tool</option>
                                <option value="4">P4-Other</option>
                            </select>
                        </div>

                        <!-- Caller -->
                        <div class="filter-group" style="margin-top: 8px;">
                            <div class="filter-group-title">Caller</div>
                            <div class="search-input-wrapper">
                                <input type="text" class="filter-input-full" id="filterCaller" placeholder="Enter Caller...">
                                <span class="search-icon" onclick="handleSearchClick('caller')">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                    </svg>
                                </span>
                            </div>
                        </div>

                        <!-- Callee -->
                        <div class="filter-group" style="margin-top: 8px;">
                            <div class="filter-group-title">Callee</div>
                            <div class="search-input-wrapper">
                                <input type="text" class="filter-input-full" id="filterCallee" placeholder="Enter Callee...">
                                <span class="search-icon" onclick="handleSearchClick('callee')">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                    </svg>
                                </span>
                            </div>
                        </div>

                        <!-- Group ID -->
                        <div class="filter-group" style="margin-top: 8px;">
                            <div class="filter-group-title">Group ID</div>
                            <div class="search-input-wrapper">
                                <input type="text" class="filter-input-full" id="filterGroupId" placeholder="Enter Group ID...">
                                <span class="search-icon" onclick="handleSearchClick('group_id')">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                    </svg>
                                </span>
                            </div>
                        </div>

                        <!-- Trace ID -->
                        <div class="filter-group" style="margin-top: 8px;">
                            <div class="filter-group-title">Trace ID</div>
                            <div class="search-input-wrapper">
                                <input type="text" class="filter-input-full" id="filterTraceId" placeholder="Enter Trace ID...">
                                <span class="search-icon" onclick="handleSearchClick('trace_id')">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                    </svg>
                                </span>
                            </div>
                        </div>

                        <!-- Full-text Search -->
                        <div class="filter-group" style="margin-top: 8px;">
                            <div class="filter-group-title">Search</div>
                            <div class="search-input-wrapper">
                                <input type="text" class="filter-input-full" id="filterSearch" placeholder="Search Question content...">
                                <span class="search-icon" onclick="handleSearchClick('search')">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                    </svg>
                                </span>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="filter-actions">
                            <button class="btn btn-primary btn-full" onclick="applyFilters()">
                                Search
                            </button>
                            <button class="btn btn-secondary btn-full" onclick="resetFilters()" style="margin-top: 8px;">
                                Reset
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Annotation Progress -->
                <div class="sidebar-section">
                    <div class="sidebar-section-header" onclick="toggleSection('progress')">
                        <span>üìä Annotation Progress</span>
                        <span class="toggle-icon" id="progressToggleIcon">‚ñº</span>
                    </div>
                    <div class="section-content" id="progressContent">
                        <!-- 2x2 Stats Grid -->
                        <div class="stats-grid-2x2">
                            <div class="stat-block pending">
                                <div class="stat-value" id="statPending">0</div>
                                <div class="stat-label">Pending</div>
                            </div>
                            <div class="stat-block annotated">
                                <div class="stat-value" id="statAnnotated">0</div>
                                <div class="stat-label">Annotated</div>
                            </div>
                            <div class="stat-block approved">
                                <div class="stat-value" id="statApproved">0</div>
                                <div class="stat-label">Approved</div>
                            </div>
                            <div class="stat-block rejected">
                                <div class="stat-value" id="statRejected">0</div>
                                <div class="stat-label">Rejected</div>
                            </div>
                        </div>
                        <!-- Progress Bar -->
                        <div class="progress-bar-container">
                            <div class="progress-bar-label">Annotation Progress</div>
                            <div class="progress-bar-track">
                                <div class="progress-bar-fill approved" id="progressApproved" style="width: 0%"></div>
                                <div class="progress-bar-fill annotated" id="progressAnnotated" style="width: 0%"></div>
                                <div class="progress-bar-fill rejected" id="progressRejected" style="width: 0%"></div>
                                <div class="progress-bar-fill pending" id="progressPending" style="width: 100%"></div>
                            </div>
                            <div class="progress-bar-legend">
                                <span class="legend-item"><span class="legend-dot approved"></span>Approved</span>
                                <span class="legend-item"><span class="legend-dot annotated"></span>Annotated</span>
                                <span class="legend-item"><span class="legend-dot rejected"></span>Rejected</span>
                                <span class="legend-item"><span class="legend-dot pending"></span>Pending</span>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Content Area - Data List -->
            <section class="annotation-main">
                <div class="main-header">
                    <h2 class="main-title">Data List</h2>
                    <div class="main-actions">
                        <span class="main-stats" id="mainStats">0 items</span>
                    </div>
                </div>

                <!-- Data List Table -->
                <div class="qa-table-container">
                    <table class="qa-table" id="qaTable">
                        <thead>
                            <tr>
                                <th data-column="id" style="width: 160px;">ID</th>
                                <th data-column="priority" style="width: 50px;">Priority</th>
                                <th data-column="status" style="width: 70px;">Status</th>
                                <th data-column="data_type" style="width: 60px;">Type</th>
                                <th data-column="caller_callee" style="width: 180px;">Call Relationship</th>
                                <th data-column="question" style="width: 25%;">Question</th>
                                <th data-column="group_trace" style="width: 160px;">Group / Trace</th>
                                <th data-column="time" style="width: 140px;">Time</th>
                                <th data-column="action" style="width: 90px;">Action</th>
                            </tr>
                        </thead>
                        <tbody id="qaTableBody">
                            <!-- Rendered by JS -->
                        </tbody>
                    </table>

                    <div class="empty-state" id="emptyState">
                        <p>No data available. Please inject data via API.</p>
                        <p style="font-size: 12px; color: #999; margin-top: 8px;">
                            POST /api/v1/deposit
                        </p>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination">
                    <span class="pagination-info" id="paginationInfo">Page 1/1, 0 items</span>
                    <div class="pagination-btns" id="paginationBtns">
                        <button class="pagination-btn" onclick="changePage(1)">First</button>
                        <button class="pagination-btn" onclick="changePage(state.currentPage - 1)">Previous</button>
                        <span class="page-num" id="pageNum">1</span>
                        <button class="pagination-btn" onclick="changePage(state.currentPage + 1)">Next</button>
                        <button class="pagination-btn" onclick="changePage(state.totalPages)">Last</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Right Drawer - Data Detail & Annotation -->
    <div class="drawer-overlay" id="drawerOverlay" onclick="closeDrawer()"></div>
    <aside class="drawer" id="detailDrawer">
        <div class="drawer-header">
            <h2 class="drawer-title">Data Annotation</h2>
            <button class="drawer-close" onclick="closeDrawer()">√ó</button>
        </div>
        <div class="drawer-body" id="drawerBody">
            <!-- Rendered by JS -->
        </div>
    </aside>

    <!-- Flatpickr DateTime Picker -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/zh.js"></script>

    <script src="./js/annotation.js?v=5"></script>
</body>
</html>
